<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Relatórios de Progresso - MBS Estudo+</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f4ff;
    color: #222;
    line-height: 1.6;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  .dark-mode {
    background-color: #121212;
    color: #eee;
  }
  h1, h2, h3, h4 {
    margin-bottom: 0.5em;
    font-weight: 700;
  }
  .container {
    max-width: 1200px;
    margin: auto;
    padding: 1em;
  }
  /* Hero Section */
  .hero-section {
    background: linear-gradient(135deg, #4361ee, #3a56d4);
    color: white;
    padding: 3em 1em;
    text-align: center;
    border-bottom-left-radius: 30px;
    border-bottom-right-radius: 30px;
    margin-bottom: 2em;
    box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
  }
  .hero-section h1 {
    font-size: 2.8rem;
    margin-bottom: 0.4em;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  .hero-section p {
    font-size: 1.2rem;
    margin-bottom: 1em;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    opacity: 0.9;
  }
  .premium-badge {
    background: linear-gradient(45deg, #FFD700, #FFED4E);
    color: #333;
    display: inline-block;
    font-weight: 700;
    padding: 0.3em 0.9em;
    border-radius: 16px;
    font-size: 1rem;
    margin-top: 0.5em;
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
  /* Week Summary */
  .week-summary {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    margin-bottom: 2.5em;
    padding: 2em;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .week-summary:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
  }
  .week-summary-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5em;
    flex-wrap: wrap;
    gap: 1em;
  }
  .week-summary-title {
    font-weight: 700;
    font-size: 1.5rem;
    color: #4361ee;
  }
  .week-period {
    font-size: 1rem;
    color: #555;
    background: #e7ecff;
    padding: 0.5em 1em;
    border-radius: 20px;
  }
  .dark-mode .week-period {
    background: #2a3b6e;
    color: #ddd;
  }
  .week-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1.5em;
    margin-bottom: 1.8em;
  }
  .week-stat {
    text-align: center;
    padding: 1.2em;
    border-radius: 12px;
    background: #f8faff;
    border: 1px solid #e7ecff;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  .dark-mode .week-stat {
    background: #1e2a47;
    border-color: #2a3b6e;
  }
  .week-stat:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
  }
  .week-stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #4361ee;
    margin-bottom: 0.3em;
  }
  .week-stat-label {
    font-size: 0.95rem;
    color: #555;
    font-weight: 500;
  }
  .dark-mode .week-stat-label {
    color: #ccc;
  }
  .week-progress {
    max-width: 700px;
    margin: auto;
    background: #f8faff;
    padding: 1.5em;
    border-radius: 14px;
    border: 1px solid #e7ecff;
  }
  .dark-mode .week-progress {
    background: #1e2a47;
    border-color: #2a3b6e;
  }
  .week-progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5em;
    font-weight: 600;
    color: #222;
  }
  .dark-mode .week-progress-label {
    color: #eee;
  }
  .week-progress-bar {
    width: 100%;
    height: 24px;
    background: #ddd;
    border-radius: 12px;
    overflow: hidden;
    margin-top: 0.5em;
  }
  .dark-mode .week-progress-bar {
    background: #333;
  }
  .week-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4361ee, #3a56d4);
    width: 0;
    transition: width 0.8s ease;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(67,97,238,0.4);
  }
  /* Metrics Cards */
  .metrics-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1.5em;
    margin-bottom: 3em;
  }
  .metric-card {
    background: white;
    border-radius: 16px;
    padding: 1.5em;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid #e7ecff;
  }
  .dark-mode .metric-card {
    background: #1e2a47;
    border-color: #2a3b6e;
  }
  .metric-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.12);
  }
  .metric-icon {
    font-size: 2.2rem;
    margin-bottom: 0.5em;
    color: #4361ee;
    transition: transform 0.3s ease;
  }
  .metric-card:hover .metric-icon {
    transform: scale(1.1);
  }
  .metric-value {
    font-weight: 700;
    font-size: 1.8rem;
    margin-bottom: 0.4em;
    color: #333;
  }
  .dark-mode .metric-value {
    color: #eee;
  }
  .metric-label {
    font-size: 0.9rem;
    color: #555;
    font-weight: 500;
  }
  .dark-mode .metric-label {
    color: #ccc;
  }
  /* Charts */
  .charts-container {
    display: grid;
    gap: 2.5em;
    margin-bottom: 3em;
  }
  @media(min-width: 720px) {
    .charts-container {
      grid-template-columns: 1fr 1fr;
    }
  }
  .chart-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.09);
    padding: 1.8em;
    transition: all 0.3s ease;
    border: 1px solid #e7ecff;
  }
  .dark-mode .chart-card {
    background: #1e2a47;
    border-color: #2a3b6e;
  }
  .chart-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0,0,0,0.12);
  }
  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5em;
    flex-wrap: wrap;
    gap: 1em;
  }
  .chart-header h3 {
    color: #4361ee;
    font-size: 1.4rem;
  }
  .dark-mode .chart-header h3 {
    color: #6a88f0;
  }
  /* Time selector buttons */
  .time-selector {
    display: flex;
    gap: 0.6em;
    flex-wrap: wrap;
  }
  .time-selector button {
    background: transparent;
    border: 2px solid #4361ee;
    color: #4361ee;
    font-weight: 600;
    padding: 0.5em 1.1em;
    border-radius: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(67,97,238,0.2);
    user-select: none;
    font-size: 0.9rem;
  }
  .dark-mode .time-selector button {
    border-color: #6a88f0;
    color: #6a88f0;
  }
  .time-selector button:first-child {
    margin-left: 0;
  }
  .time-selector button.active,
  .time-selector button:hover {
    background: #4361ee;
    color: #fff;
    box-shadow: 0 4px 12px rgba(67,97,238,0.4);
    transform: translateY(-2px);
  }
  .dark-mode .time-selector button.active,
  .dark-mode .time-selector button:hover {
    background: #6a88f0;
  }
  /* Bar chart */
  .chart-container {
    display: flex;
    align-items: flex-end;
    gap: 12px;
    height: 220px;
    padding-bottom: 1.8em;
    background: #f8faff;
    border-radius: 12px;
    padding: 1.2em;
    overflow-x: auto;
    border: 1px solid #e7ecff;
  }
  .dark-mode .chart-container {
    background: #1e2a47;
    border-color: #2a3b6e;
  }
  .chart-container::-webkit-scrollbar {
    height: 8px;
  }
  .chart-container::-webkit-scrollbar-thumb {
    background-color: #4361ee;
    border-radius: 4px;
  }
  .dark-mode .chart-container::-webkit-scrollbar-thumb {
    background-color: #6a88f0;
  }
  .chart-container::-webkit-scrollbar-track {
    background: #ddd;
    border-radius: 4px;
  }
  .dark-mode .chart-container::-webkit-scrollbar-track {
    background: #333;
  }
  .chart-bar {
    background: linear-gradient(to top, #4361ee, #5882fa);
    border-radius: 8px 8px 0 0;
    width: 28px;
    min-width: 28px;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 12px rgba(67,97,238,0.3);
    z-index: 1;
  }
  .dark-mode .chart-bar {
    background: linear-gradient(to top, #6a88f0, #8ca1f2);
  }
  .chart-bar:hover,
  .chart-bar:focus {
    background: linear-gradient(to top, #3a56d4, #4d72f0);
    transform: scale(1.08);
    z-index: 10;
    box-shadow: 0 6px 16px rgba(67,97,238,0.5);
  }
  .dark-mode .chart-bar:hover {
    background: linear-gradient(to top, #5a78e0, #7a95f0);
  }
  .chart-bar-value {
    padding: 4px 6px;
    background: rgba(0,0,0,0.5);
    border-radius: 6px 6px 0 0;
    font-size: 0.8rem;
    font-weight: 700;
    color: #fff;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    user-select: none;
    text-align: center;
    width: 100%;
  }
  .chart-bar-label {
    margin-top: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    color: #4361ee;
    user-select: none;
    text-align: center;
    white-space: nowrap;
  }
  .dark-mode .chart-bar-label {
    color: #6a88f0;
  }
  /* Line chart */
  .line-chart {
    position: relative;
  }
  .line-chart-grid {
    position: relative;
    height: 240px;
    background: #f8faff;
    border-radius: 12px;
    margin-bottom: 1.2em;
    border: 1px solid #e7ecff;
  }
  .dark-mode .line-chart-grid {
    background: #1e2a47;
    border-color: #2a3b6e;
  }
  .grid-line {
    position: absolute;
    width: 100%;
    height: 1px;
    background: rgba(67,97,238,0.2);
  }
  .dark-mode .grid-line {
    background: rgba(106,136,240,0.3);
  }
  .line-chart-svg {
    overflow: visible;
    user-select: none;
    width: 100%;
    height: 240px;
  }
  .line-chart-path {
    stroke-linejoin: round;
    stroke-linecap: round;
    stroke-width: 4;
    stroke: #4361ee;
    fill: none;
    filter: drop-shadow(0 0 4px rgba(67,97,238,0.4));
    transition: stroke-dashoffset 0.8s ease;
  }
  .dark-mode .line-chart-path {
    stroke: #6a88f0;
  }
  .line-chart-dots circle {
    fill: #4361ee;
    stroke: white;
    stroke-width: 3px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .dark-mode .line-chart-dots circle {
    fill: #6a88f0;
  }
  .line-chart-dots circle:hover,
  .line-chart-dots circle:focus {
    r: 8;
    stroke-width: 2px;
    fill: #3a56d4;
    filter: drop-shadow(0 0 6px rgba(67,97,238,0.6));
  }
  .dark-mode .line-chart-dots circle:hover {
    fill: #5a78e0;
  }
  .line-chart-y-labels {
    position: absolute;
    left: -40px;
    top: 0;
    height: 240px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    font-weight: 600;
    color: #4361ee;
    font-size: 0.9rem;
  }
  .dark-mode .line-chart-y-labels {
    color: #6a88f0;
  }
  .line-chart-x-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-weight: 600;
    color: #4361ee;
    font-size: 0.95rem;
  }
  .dark-mode .line-chart-x-labels {
    color: #6a88f0;
  }
  /* Pie chart */
  .pie-chart-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 1em;
  }
  #pie-chart {
    width: 300px;
    height: 300px;
    margin-bottom: 1em;
  }
  .legend {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.8rem;
    margin-top: 0.5em;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    font-weight: 600;
  }
  .legend-color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  /* Footer */
  footer {
    background: linear-gradient(135deg, #4361ee, #3a56d4);
    color: white;
    padding: 2em 0;
    text-align: center;
    font-size: 0.95rem;
    border-top-left-radius: 30px;
    border-top-right-radius: 30px;
    margin-top: 2em;
    box-shadow: 0 -8px 20px rgba(67, 97, 238, 0.3);
  }
  footer p {
    margin: 0.3em 0;
    opacity: 0.9;
  }
  /* Theme toggle */
  .theme-toggle {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: #4361ee;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.6rem;
    user-select: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
    z-index: 100;
    border: 2px solid white;
  }
  .theme-toggle:hover {
    background: #3a56d4;
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0,0,0,0.4);
  }
  .theme-toggle.dark {
    background: #1e2a47;
  }
  .theme-toggle.dark:hover {
    background: #2a3b6e;
  }
  /* Loading animation */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-radius: 50%;
    border-top: 3px solid #4361ee;
    animation: spin 1s linear infinite;
    margin-right: 8px;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  /* Responsive */
  @media (max-width: 768px) {
    .hero-section h1 {
      font-size: 2.2rem;
    }
    .container {
      padding: 0.8em;
    }
    .week-summary {
      padding: 1.5em;
    }
    .chart-card {
      padding: 1.2em;
    }
    .charts-container {
      grid-template-columns: 1fr;
    }
    .week-stats {
      grid-template-columns: repeat(2, 1fr);
    }
    .metrics-container {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (max-width: 480px) {
    .week-stats {
      grid-template-columns: 1fr;
    }
    .metrics-container {
      grid-template-columns: 1fr;
    }
    .week-summary-header {
      flex-direction: column;
      align-items: center;
    }
    .chart-header {
      flex-direction: column;
      align-items: stretch;
    }
    .time-selector {
      justify-content: center;
    }
  }
</style>
</head>
<body>
<section class="hero-section">
  <div class="container hero-content">
    <h1>Relatórios de Progresso</h1>
    <p>Visualize seu desempenho com gráficos e métricas detalhadas sobre seu tempo de estudo e produtividade</p>
    <div class="premium-badge" title="Área Premium"><span>⭐</span> Premium</div>
  </div>
</section>
<main class="container">
  <h2 class="section-title">Seu <span>Desempenho</span></h2>
  <!-- Weekly Summary -->
  <div class="week-summary" aria-label="Resumo da semana atual">
    <div class="week-summary-header">
      <h3 class="week-summary-title">Resumo Semanal</h3>
      <div class="week-period" id="week-period" aria-live="polite">--/--/---- - --/--/----</div>
    </div>
    <div class="week-stats" role="list">
      <div class="week-stat" role="listitem" tabindex="0">
        <div class="week-stat-value" id="week-focus-time">--h --m</div>
        <div class="week-stat-label">Tempo de Foco</div>
      </div>
      <div class="week-stat" role="listitem" tabindex="0">
        <div class="week-stat-value" id="week-sessions">--</div>
        <div class="week-stat-label">Sessões Concluídas</div>
      </div>
      <div class="week-stat" role="listitem" tabindex="0">
        <div class="week-stat-value" id="week-xp">--</div>
        <div class="week-stat-label">Pontos de XP</div>
      </div>
      <div class="week-stat" role="listitem" tabindex="0">
        <div class="week-stat-value" id="week-streak">--</div>
        <div class="week-stat-label">Dias Seguidos</div>
      </div>
    </div>
    <div class="week-progress" aria-label="Barra de progresso da meta semanal">
      <div class="week-progress-label">
        <span>Meta Semanal de Estudo</span>
        <span id="week-progress-text">--% completo</span>
      </div>
      <div class="week-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="week-progress-fill" id="week-progress-fill" style="width: 0%"></div>
      </div>
    </div>
  </div>
  <!-- Metrics Cards -->
  <div class="metrics-container" aria-label="Métricas gerais de estudo">
    <div class="metric-card" tabindex="0">
      <div class="metric-icon" aria-hidden="true">⏰</div>
      <div class="metric-value" id="total-time">--h --m</div>
      <div class="metric-label">Tempo Total de Estudo</div>
    </div>
    <div class="metric-card" tabindex="0">
      <div class="metric-icon" aria-hidden="true">🎯</div>
      <div class="metric-value" id="focus-sessions">--</div>
      <div class="metric-label">Sessões de Foco Concluídas</div>
    </div>
    <div class="metric-card" tabindex="0">
      <div class="metric-icon" aria-hidden="true">☕</div>
      <div class="metric-value" id="short-breaks">--</div>
      <div class="metric-label">Pausas Curtas Tomadas</div>
    </div>
    <div class="metric-card" tabindex="0">
      <div class="metric-icon" aria-hidden="true">🍵</div>
      <div class="metric-value" id="long-breaks">--</div>
      <div class="metric-label">Pausas Prolongadas Tomadas</div>
    </div>
    <div class="metric-card" tabindex="0">
      <div class="metric-icon" aria-hidden="true">🔥</div>
      <div class="metric-value" id="xp">--</div>
      <div class="metric-label">Pontos de XP Adquiridos</div>
    </div>
    <div class="metric-card" tabindex="0">
      <div class="metric-icon" aria-hidden="true">📅</div>
      <div class="metric-value" id="streak">--</div>
      <div class="metric-label">Dias Seguidos Estudando</div>
    </div>
  </div>
  <!-- Charts Container -->
  <div class="charts-container" aria-label="Gráficos de desempenho">
    <!-- Daily Focus Chart -->
    <div class="chart-card" aria-label="Gráfico de barras de tempo de foco diário">
      <div class="chart-header">
        <h3>Tempo de Foco Diário (Esta Semana)</h3>
        <div class="time-selector" role="group" aria-label="Seleção de período para gráfico diário">
          <button class="active" data-range="7" aria-pressed="true">7 dias</button>
          <button data-range="30" aria-pressed="false">30 dias</button>
          <button data-range="90" aria-pressed="false">90 dias</button>
        </div>
      </div>
      <div class="chart-container" id="daily-focus-chart" aria-live="polite">
        <div class="loading-container" style="width:100%; height:150px; display:flex; justify-content:center; align-items:center;">
          <div class="loading"></div> Carregando dados...
        </div>
      </div>
    </div>
    <!-- Focus vs Breaks Chart -->
    <div class="chart-card" aria-label="Gráfico comparativo de foco e pausas">
      <div class="chart-header">
        <h3>Foco vs. Pausas</h3>
        <div class="time-selector" role="group" aria-label="Seleção de período para gráfico foco vs pausas">
          <button class="active" data-range="week" aria-pressed="true">Esta Semana</button>
          <button data-range="month" aria-pressed="false">Este Mês</button>
          <button data-range="year" aria-pressed="false">Este Ano</button>
        </div>
      </div>
      <div class="pie-chart-container">
        <svg id="pie-chart" viewBox="0 0 300 300" role="img" aria-label="Gráfico de pizza do tempo dedicado a foco e pausas"></svg>
        <div class="legend" aria-hidden="true">
          <div class="legend-item">
            <div class="legend-color" style="background:#4361ee"></div>Foco
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#f27171"></div>Pausas Curtas
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background:#f2b46e"></div>Pausas Longas
          </div>
        </div>
      </div>
    </div>
    <!-- Productivity Trend Chart -->
    <div class="chart-card" aria-label="Gráfico de linha da evolução da produtividade">
      <div class="chart-header">
        <h3>Evolução da Produtividade</h3>
        <div class="time-selector" role="group" aria-label="Seleção de período para gráfico de linha">
          <button class="active" data-range="7" aria-pressed="true">Últimos 7 Dias</button>
          <button data-range="30" aria-pressed="false">Últimos 30 Dias</button>
          <button data-range="90" aria-pressed="false">Últimos 90 Dias</button>
        </div>
      </div>
      <div class="line-chart">
        <div class="line-chart-grid" style="position: relative; height: 240px; background: #f8faff; border-radius: 10px; margin-bottom: 1em;">
          <!-- Grid lines -->
          <div class="grid-line" style="top: 0;"></div>
          <div class="grid-line" style="top: 25%;"></div>
          <div class="grid-line" style="top: 50%;"></div>
          <div class="grid-line" style="top: 75%;"></div>
          <div class="grid-line" style="top: 100%;"></div>
        </div>
        <svg width="100%" height="240" viewBox="0 0 400 240" class="line-chart-svg" style="overflow: visible;">
          <path class="line-chart-path" d="" fill="none" stroke="#4361ee" stroke-width="4" />
          <g class="line-chart-dots"></g>
        </svg>
        <div class="line-chart-y-labels" style="display:flex; flex-direction: column; justify-content: space-between; height: 240px; position: absolute; left: -40px; top: 0; font-size: 0.9rem; color:#555;">
          <span>4h</span>
          <span>3h</span>
          <span>2h</span>
          <span>1h</span>
          <span>0h</span>
        </div>
        <div class="line-chart-x-labels" style="display:flex; justify-content: space-between; margin-top: 4px; font-size: 0.95rem; color:#555; padding: 0 15px;">
          <span>Seg</span>
          <span>Ter</span>
          <span>Qua</span>
          <span>Qui</span>
          <span>Sex</span>
          <span>Sáb</span>
          <span>Dom</span>
        </div>
      </div>
    </div>
    <!-- Session Distribution Chart -->
    <div class="chart-card" aria-label="Gráfico de distribuição de sessões ao longo do dia">
      <div class="chart-header">
        <h3>Distribuição de Sessões</h3>
        <div class="time-selector" role="group" aria-label="Seleção de período para gráfico de distribuição de sessões">
          <button class="active" data-range="today" aria-pressed="true">Hoje</button>
          <button data-range="week" aria-pressed="false">Esta Semana</button>
          <button data-range="month" aria-pressed="false">Este Mês</button>
        </div>
      </div>
      <div class="chart-container" id="session-distribution-chart" aria-live="polite">
        <div class="loading-container" style="width:100%; height:150px; display:flex; justify-content:center; align-items:center;">
          <div class="loading"></div> Carregando dados...
        </div>
      </div>
    </div>
  </div>
</main>
<footer>
  <div class="container">
    <div class="footer-content">
      <p>&copy; 2025 MBS Estudo+. Todos os direitos reservados.</p>
      <p>Dados baseados em seu uso do Modo Foco (Pomodoro)</p>
      <p>Atualização em tempo real do seu desempenho de estudo</p>
    </div>
  </div>
</footer>
<!-- Botão para alternar tema -->
<div class="theme-toggle" onclick="toggleTheme()" title="Alternar tema claro/escuro" role="button" aria-pressed="false" tabindex="0" aria-label="Alternar tema claro e escuro">
  🌓
</div>
<script>
  // Função para obter o início da semana (segunda-feira 00:00)
  function inicioDaSemana(data = new Date()) {
    const d = new Date(data);
    const dia = d.getDay(); // 0 (domingo) a 6 (sábado)
    const diff = (dia === 0 ? -6 : 1) - dia; // ajusta para segunda-feira
    d.setDate(d.getDate() + diff);
    d.setHours(0, 0, 0, 0);
    return d;
  }

  // Função para obter o fim da semana (domingo 23:59:59)
  function fimDaSemana(data = new Date()) {
    const inicio = inicioDaSemana(data);
    const fim = new Date(inicio);
    fim.setDate(fim.getDate() + 6);
    fim.setHours(23, 59, 59, 999);
    return fim;
  }

  // Filtra sessões que estão dentro da semana atual
  function filtrarSessaoDaSemana(registros) {
    const inicio = inicioDaSemana();
    const fim = fimDaSemana();

    return registros.filter(reg => {
      const dataSessao = new Date(reg.data);
      return dataSessao >= inicio && dataSessao <= fim;
    });
  }

  // Calcula total minutos e número de sessões
  function calcularEstatisticas(registros) {
    let totalMinutos = 0;
    registros.forEach(r => totalMinutos += r.duracao);
    const totalSessoes = registros.length;
    const mediaPorSessao = totalSessoes ? (totalMinutos / totalSessoes).toFixed(2) : 0;
    return { totalMinutos, totalSessoes, mediaPorSessao };
  }

  // Função para formatar minutos em "Xh Ym"
  function formatarHorasEMinutos(minutos) {
    const h = Math.floor(minutos / 60);
    const m = minutos % 60;
    return `${h > 0 ? h + 'h ' : ''}${m}m`;
  }
  
  // Função para calcular dias consecutivos
  function calcularStreak(sessoes) {
    if (sessoes.length === 0) return 0;
    
    const datas = sessoes.map(s => s.data.split('T')[0]).sort();
    const unicas = [...new Set(datas)];
    
    if (unicas.length === 0) return 0;
    
    let streak = 1;
    const hoje = new Date().toISOString().split('T')[0];
    let current = new Date(unicas[unicas.length - 1]);
    
    // Se o último dia não for hoje, verificar se foi ontem
    if (unicas[unicas.length - 1] !== hoje) {
      const ontem = new Date();
      ontem.setDate(ontem.getDate() - 1);
      const ontemStr = ontem.toISOString().split('T')[0];
      if (unicas[unicas.length - 1] !== ontemStr) {
        return 0; // Não estudou ontem nem hoje
      }
    }
    
    // Contar dias consecutivos para trás
    for (let i = unicas.length - 2; i >= 0; i--) {
      const dataAtual = new Date(unicas[i]);
      const diffDays = Math.floor((current - dataAtual) / (1000 * 60 * 60 * 24));
      
      if (diffDays === 1) {
        streak++;
        current = dataAtual;
      } else if (diffDays > 1) {
        break;
      }
    }
    
    return streak;
  }

  // Função para atualizar gráfico de barras
  function atualizarGraficoBarras(containerId, dados, maxValor, labelCallback) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    const max = maxValor || Math.max(...dados.map(d => d.valor), 60);
    const diasDaSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
    
    dados.forEach(item => {
      const heightPercent = (item.valor / max) * 100;
      const bar = document.createElement('div');
      bar.className = 'chart-bar';
      bar.style.height = heightPercent + '%';
      bar.setAttribute('tabindex', '0');
      bar.setAttribute('aria-label', `${item.valor} minutos ${labelCallback(item)}`);
      
      const barValue = document.createElement('div');
      barValue.className = 'chart-bar-value';
      barValue.textContent = `${item.valor}m`;
      
      const barLabel = document.createElement('div');
      barLabel.className = 'chart-bar-label';
      barLabel.textContent = item.label;
      
      bar.appendChild(barValue);
      bar.appendChild(barLabel);
      container.appendChild(bar);
    });
  }
  
  // Função para desenhar gráfico de pizza
  function desenharGraficoPizza(data, containerId, colors) {
    const svg = document.getElementById(containerId);
    svg.innerHTML = '';
    
    const total = data.reduce((sum, item) => sum + item.valor, 0);
    if (total === 0) return;
    
    let startAngle = 0;
    const radius = 120;
    const center = 150;
    
    data.forEach((item, index) => {
      if (item.valor <= 0) return;
      const angle = (item.valor / total) * 360;
      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("fill", colors[index]);
      path.setAttribute("d", describeArc(center, center, radius, startAngle, startAngle + angle));
      path.setAttribute("tabindex", "0");
      path.setAttribute("aria-label", `${item.nome}: ${((item.valor / total) * 100).toFixed(1)}% (${item.valor} minutos)`);
      svg.appendChild(path);
      startAngle += angle;
    });
    
    // Círculo central branco (doughnut)
    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    circle.setAttribute("cx", center);
    circle.setAttribute("cy", center);
    circle.setAttribute("r", radius * 0.6);
    circle.setAttribute("fill", "#f8faff");
    svg.appendChild(circle);
  }
  
  // Funções auxiliares para gráfico de pizza
  function describeArc(x, y, radius, startAngle, endAngle){
    const start = polarToCartesian(x, y, radius, endAngle);
    const end = polarToCartesian(x, y, radius, startAngle);
    const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
    return [
      "M", start.x, start.y,
      "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y,
      "L", x, y,
      "Z"
    ].join(" ");
  }
  
  function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
    var angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
    return {
      x: centerX + (radius * Math.cos(angleInRadians)),
      y: centerY + (radius * Math.sin(angleInRadians))
    };
  }
  
  // Função para atualizar gráfico de linha
  function atualizarGraficoLinha(dados) {
    const svg = document.querySelector('.line-chart-svg');
    const path = svg.querySelector('.line-chart-path');
    const dots = svg.querySelector('.line-chart-dots');
    dots.innerHTML = '';
    
    if (dados.length === 0) return;
    
    const width = 400;
    const height = 240;
    const padding = 40;
    const maxX = width - padding;
    const maxY = height - padding;
    
    // Encontrar valores máximos
    const maxValor = Math.max(...dados.map(d => d.valor), 60);
    
    // Gerar pontos para o caminho
    let pathData = '';
    dados.forEach((ponto, index) => {
      const x = padding + (index * (maxX - padding) / (dados.length - 1));
      const y = maxY - ((ponto.valor / maxValor) * (maxY - 20));
      
      if (index === 0) {
        pathData += `M ${x} ${y} `;
      } else {
        pathData += `L ${x} ${y} `;
      }
      
      // Adicionar ponto
      const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      circle.setAttribute("cx", x);
      circle.setAttribute("cy", y);
      circle.setAttribute("r", 5);
      circle.setAttribute("data-value", ponto.valor);
      circle.setAttribute("tabindex", "0");
      circle.setAttribute("aria-label", `${ponto.valor} minutos em ${ponto.label}`);
      dots.appendChild(circle);
    });
    
    path.setAttribute('d', pathData);
    
    // Animar o traçado
    const length = path.getTotalLength();
    path.style.strokeDasharray = length;
    path.style.strokeDashoffset = length;
    setTimeout(() => {
      path.style.transition = 'stroke-dashoffset 1.5s ease';
      path.style.strokeDashoffset = '0';
    }, 100);
  }

  // Função principal para carregar dados
  async function carregarDadosRelatorio() {
    // Mostrar indicador de carregamento
    document.querySelectorAll('.loading-container').forEach(el => {
      el.innerHTML = '<div class="loading"></div> Carregando dados...';
    });
    
    try {
      // Simular carregamento de dados (em um aplicativo real, isso seria uma chamada API)
      await new Promise(resolve => setTimeout(resolve, 800));
      
      // Carregar dados do localStorage
      const registros = JSON.parse(localStorage.getItem('foco_semana') || '[]');
      const progresso = JSON.parse(localStorage.getItem('progressoMBS') || '{}');
      
      // Verificar se temos dados
      if (registros.length === 0) {
        // Atualizar containers com mensagem de erro
        document.querySelectorAll('.loading-container').forEach(el => {
          el.innerHTML = 'Nenhum dado de estudo encontrado. Comece a usar o modo foco para gerar relatórios.';
          el.style.color = '#e74c3c';
          el.style.fontSize = '0.9rem';
        });
        
        // Atualizar métricas com valores padrão
        document.getElementById('total-time').textContent = '0m';
        document.getElementById('focus-sessions').textContent = '0';
        document.getElementById('short-breaks').textContent = '0';
        document.getElementById('long-breaks').textContent = '0';
        document.getElementById('xp').textContent = '0';
        document.getElementById('streak').textContent = '0';
        
        return;
      }
      
      // Filtrar sessões da semana atual
      const sessoesSemana = filtrarSessaoDaSemana(registros);
      const statsSemana = calcularEstatisticas(sessoesSemana);
      
      // Calcular métricas gerais
      const statsTotal = calcularEstatisticas(registros);
      const streak = calcularStreak(registros);
      
      // Atualizar métricas cards
      document.getElementById('total-time').textContent = formatarHorasEMinutos(statsTotal.totalMinutos);
      document.getElementById('focus-sessions').textContent = statsTotal.totalSessoes;
      
      // Para pausas curtas e longas (assumindo padrão Pomodoro)
      const pausasCurtas = Math.floor(statsTotal.totalSessoes * 0.8);
      const pausasLongas = Math.floor(statsTotal.totalSessoes / 4);
      
      document.getElementById('short-breaks').textContent = pausasCurtas;
      document.getElementById('long-breaks').textContent = pausasLongas;
      document.getElementById('xp').textContent = statsTotal.totalSessoes * 10;
      document.getElementById('streak').textContent = streak;
      
      // Atualizar resumo semanal
      document.getElementById('week-focus-time').textContent = formatarHorasEMinutos(statsSemana.totalMinutos);
      document.getElementById('week-sessions').textContent = statsSemana.totalSessoes;
      document.getElementById('week-xp').textContent = statsSemana.totalSessoes * 10;
      document.getElementById('week-streak').textContent = streak;
      
      // Atualizar período da semana
      const hoje = new Date();
      const primeiroDiaSemana = new Date(hoje);
      primeiroDiaSemana.setDate(hoje.getDate() - hoje.getDay() + 1); // segunda
      const ultimoDiaSemana = new Date(primeiroDiaSemana);
      ultimoDiaSemana.setDate(primeiroDiaSemana.getDate() + 6); // domingo
      
      const formatDate = (d) => d.toLocaleDateString('pt-BR');
      document.getElementById('week-period').textContent = `${formatDate(primeiroDiaSemana)} - ${formatDate(ultimoDiaSemana)}`;
      
      // Atualizar barra de progresso semanal
      const metaSemanalMinutos = 600; // 10 horas
      const progressoPercentual = Math.min(100, Math.round((statsSemana.totalMinutos / metaSemanalMinutos) * 100));
      document.getElementById('week-progress-text').textContent = `${progressoPercentual}% completo`;
      const barra = document.getElementById('week-progress-fill');
      barra.style.width = '0%';
      
      // Animação da barra de progresso
      setTimeout(() => {
        barra.style.transition = 'width 1.2s ease';
        barra.style.width = `${progressoPercentual}%`;
      }, 200);
      
      // Atualizar gráficos
      atualizarGraficos(sessoesSemana, registros);
      
    } catch (error) {
      console.error('Erro ao carregar dados:', error);
      // Atualizar containers com mensagem de erro
      document.querySelectorAll('.loading-container').forEach(el => {
        el.innerHTML = 'Erro ao carregar dados. Tente novamente mais tarde.';
        el.style.color = '#e74c3c';
      });
    }
  }
  
  // Função para atualizar todos os gráficos
  function atualizarGraficos(sessoesSemana, todasSessoes) {
    const diasDaSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
    const hoje = new Date();
    
    // Gráfico de barras diário
    const dadosBarras = [];
    for (let i = 0; i < 7; i++) {
      const data = new Date(hoje);
      data.setDate(hoje.getDate() - (6 - i));
      const diaSemana = data.getDay();
      const diaStr = data.toISOString().split('T')[0];
      
      const minutosDia = sessoesSemana
        .filter(s => s.data.startsWith(diaStr))
        .reduce((acc, s) => acc + s.duracao, 0);
      
      dadosBarras.push({
        valor: minutosDia,
        label: diasDaSemana[diaSemana],
        data: diaStr
      });
    }
    
    atualizarGraficoBarras('daily-focus-chart', dadosBarras, 240, item => `no dia ${item.data}`);
    
    // Gráfico de linha de produtividade
    const dadosLinha = dadosBarras.map(item => ({
      valor: item.valor,
      label: item.label
    }));
    
    atualizarGraficoLinha(dadosLinha);
    
    // Gráfico de pizza foco vs pausas
    const focoTotal = sessoesSemana.reduce((acc, s) => acc + s.duracao, 0);
    const pausasCurtas = sessoesSemana.length * 5; // 5 minutos por pausa curta
    const pausasLongas = Math.floor(sessoesSemana.length / 4) * 15; // 15 minutos a cada 4 sessões
    
    desenharGraficoPizza([
      { nome: 'Foco', valor: focoTotal },
      { nome: 'Pausas Curtas', valor: pausasCurtas },
      { nome: 'Pausas Longas', valor: pausasLongas }
    ], 'pie-chart', ['#4361ee', '#f27171', '#f2b46e']);
    
    // Gráfico de distribuição de sessões
    const distribuicao = Array(24).fill(0);
    sessoesSemana.forEach(sessao => {
      const hora = new Date(sessao.data).getHours();
      distribuicao[hora]++;
    });
    
    const dadosDistribuicao = distribuicao
      .map((valor, hora) => ({
        valor,
        label: `${hora.toString().padStart(2, '0')}h`
      }))
      .filter(item => item.valor > 0);
    
    atualizarGraficoBarras('session-distribution-chart', dadosDistribuicao, 5, item => `às ${item.label}`);
  }
  
  // Função para alternar tema
  function toggleTheme() {
    const body = document.body;
    const themeToggle = document.querySelector('.theme-toggle');
    
    body.classList.toggle('dark-mode');
    
    if (body.classList.contains('dark-mode')) {
      themeToggle.classList.add('dark');
      themeToggle.innerHTML = '☀️';
      themeToggle.setAttribute('aria-pressed', 'true');
      themeToggle.setAttribute('title', 'Alternar para tema claro');
    } else {
      themeToggle.classList.remove('dark');
      themeToggle.innerHTML = '🌓';
      themeToggle.setAttribute('aria-pressed', 'false');
      themeToggle.setAttribute('title', 'Alternar para tema escuro');
    }
  }
  
  // Event listeners para seletores de tempo
  document.addEventListener('DOMContentLoaded', function() {
    // Carregar dados iniciais
    carregarDadosRelatorio();
    
    // Configurar seletores de tempo
    const allSelectors = document.querySelectorAll('.time-selector');
    allSelectors.forEach(selector => {
      const buttons = selector.querySelectorAll('button');
      buttons.forEach(button => {
        button.addEventListener('click', function() {
          buttons.forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-pressed', 'false');
          });
          this.classList.add('active');
          this.setAttribute('aria-pressed', 'true');
          
          // Em um aplicativo real, aqui atualizaria os gráficos com base no período selecionado
          // Para demonstração, apenas recarrega os dados
          carregarDadosRelatorio();
        });
      });
    });
    
    // Configurar botão de tema
    const themeToggle = document.querySelector('.theme-toggle');
    themeToggle.addEventListener('click', toggleTheme);
    themeToggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleTheme();
      }
    });
  });
</script>
</body>
</html>